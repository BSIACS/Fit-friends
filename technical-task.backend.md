# FitFriends

FitFriends — это онлайн площадка для поиска тренировок и их создания. Веб-приложение (сайт) функционирует как смесь соцсети и биржи объявлений. Тренеры создают тренировки, а пользователи могут покупать их и заниматься по ним, приглашать других пользователей на совместные тренировки, а тренеров просить провести индивидуальную тренировку.
Проект состоит из трёх итераций, в рамках которых последовательно вы будете собирать онлайн-площадку. 

## Задача проекта

Разработать веб-приложения: фронтенд и бэкенд. Соединить фронтенд и бэкенд, подготовить проект к деплою. Вёрстка проекта предоставляется готовой. Для разработки применяются технологии, перечисленные в разделе «Технические требования». Применение дополнительных инструментов, не указанных в списке, допускается.

## Технические требования

## Общие

Вёрстка готова. Внесение правок допускается.
Разработка проектов производится в монорепозитории.
Применять дополнительные пакеты разрешено.

## Сервис API

1. Подготовлена общая инфраструктура проекта: docker-compose для разворачивания СУБД, начальное заполнение базы данных (при необходимости), настроены сценарии запуска и так далее.
2. Реализованы все сценарии раздела «Пользователи». Реализована полная поддержка JWT.
3. Сервис конфигурируются через переменные окружения (всё что необходимо для работы запрашиваемых сценариев).
4. Реализованы сценарии раздела «Личный кабинет тренера»: создание тренировки, редактирование тренировки, детальная информация о тренировке, список тренировок, список друзей.
5. Реализованы все сценарии раздела «Личный кабинет пользователя»: список друзей, список тренировок.
6. Реализованы сценарии раздела «Оповещения»
7. Реализованы сценарии раздела «Персональные тренировки»
8. Реализованы сценарии раздела «Каталог тренировок»
9. Реализованы сценарии раздела «Отзывы»
10. Сервис конфигурируются через переменные окружения (всё что необходимо для работы запрашиваемых сценариев).

## Предметная область

### Пользователь

Пользователь представлен набором информации:
- Имя. Имя пользователя. Например: Иван. Ограничения: обязательно для заполнения; минимальная длина 1 символ; максимальная длина 15 символов; только буквы русского/английского алфавита.
- Электронная почта. Адрес электронной почты, используется в качестве имени пользователя (логин). Ограничения: обязательно для заполнения; валидный адрес электронной почты; уникальность — в системе не может быть двух пользователей с одинаковым email.
- Аватар пользователя. Ограничения: изображение в формате .jpg или .png; максимальный размер изображения 1 мегабайт.
- Пароль. Ограничения: обязательно для заполнения; минимальная длина 6 символов; максимальная длина 12 символов.
- Пол. Ограничения: обязательно для заполнения. Одно из трёх значений: женский, мужской и неважно.
- Дата рождения. Ограничения: дата рождения включает день, месяц и год; необязательно для заполнения.
- Роль. Роль пользователя в системе. Ограничения: обязательно для заполнения; доступные роли тренер и пользователь.
- Описание. Текст с общей информацией. Минимальная длина 10 символ. Максимальная длина: 140 символов.
- Локация. Станция метро. Ограничения: обязательно для заполнения; одна из станций: «Пионерская», «Петроградская», «Удельная», «Звёздная», «Спортивная».
- Изображение для страницы. Фоновая картинка для карточки пользователя. Ограничения: обязательно для загрузки; изображение в формате jpg/png. Список фоновых изображений предопределён (берутся из вёрстки). Оционально — для данного функционала можно переиспользовать изображение аватра.
- Дата создания. Дата создания пользователя в системе. Заполняется автоматически.

#### Роль Пользователь. Дополнительная информация (опросник):
- Уровень подготовки. Уровень физической подготовки пользователя. Ограничения: обязательно для заполнения; допустимые значения: новичок, любитель, профессионал.
- Тип тренировок. Ограничения: обязательно для заполнения; допустимые значения: йога, бег, бокс, стрейчинг, кроссфит, аэробика, пилатес; одновременно может быть выбрано не больше трёх значений.
- Время на тренировку. Время на тренировку указывается в предопределённых интервалах. Ограничения: обязательно для заполнения; один из вариантов: 10-30 мин, `30-50 мин, 50-80 мин, 80-100 мин.
- Количество калорий для сброса. Ограничения: обязательно для заполнения; минимальное значение 1000, максимально значение 5000; только целые числа.
- Количество калорий для траты в день. Ограничения: обязательно для заполнения; минимальное значение 1000; максимальное значение: 5000; только целые числа.
- Готовность к тренировке. Флаг готовности пользователя к приглашениям на тренировку. Ограничения: обязательно для заполнения.

#### Роль Тренер. Дополнительная информация (опросник):

- Уровень подготовки. Уровень физической подготовки пользователя. Ограничения: обязательно для заполнения; допустимые значения: новичок, любитель, профессионал.
- Тип тренировок. Ограничения: обязательно для заполнения; допустимые значения: йога, бег, бокс, стрейчинг, кроссфит, аэробика, пилатес; одновременно может быть выбрано только 3 значения.
- Сертификаты. Сертификат тренера, pdf-файл. Ограничения: обязательно для заполнения; файл в формате pdf; только один файл.
- Заслуги тренера. Текст с описанием заслуг тренера. Минимальная длина 10 символ. Максимальная длина: 140 символов.
- Личные тренировки. Флаг готовности проводить индивидуальные тренировки.

### Тренировка

Тренировка представлена набором информации:

- Название тренировки. Ограничения: обязательно для заполнения; минимальная длина 1 символ, максимальная длина 15 символов.
- Фоновое изображение. Фоновая картинка для карточки тренировки. Ограничения: обязательно для загрузки; изображение в формате jpg/png. Список фоновых изображений предопределён (берутся из макета).
- Уровень. Уровень пользователя, на которого рассчитана тренировка. Ограничения: обязательное для заполнения; значения для заполнения: новичок, любитель, профессионал; только одно значение из перечисленных.
- Тип тренировки. Ограничения: обязательно для заполнения; одно значение из списка: йога, бег, бокс, стрейчинг, кроссфит, аэробика, пилатес.
- Длительность тренировки. Продолжительность тренировки в минутах. Ограничения: обязательно для заполнения; один из предопределённых вариантов: 10-30 мин, 30-50 мин, 50-80 мин, 80-100 мин.
- Цена. Стоимость тренировки в рублях. Ограничения: целые числа; число больше или равно 0. Значение 0 подразумевает бесплатную тренировку.
- Количество калорий. Ограничения: обязательно для заполнения; минимальное значение 1000, максимально значение 5000; только целые числа.
- Описание. Описание тренировки. Ограничения: обязательно для заполнения; минимальная длина 10 символов; максимальная длина 140 символов.
- Пол. Пол пользователя для которого предназначена тренировка. Ограничения: обязательно для заполнения. Одно из трёх значений: для женщин, для мужчин и для всех.
- Видео тренировки. Видео файл с демонстрацией тренировки. Ограничения: обязательно для заполнения; только одно видео; формат видео mov/avi/mp4.
- Рейтинг тренировки. Рейтинг тренировки. Рассчитывается автоматически на основании пользователей. По умолчанию значение 0.
- Тренер. Тренер, создатель тренировки.
- Признак специального предложения. Флаг определяет участие тренировки (участвует, не участвует) в качестве специального предложения.

### Отзыв

Отзыв представлен набором информации:

- Автор отзыва. Информация об авторе (пользователе) отзыва.
  Ограничения: 
  существующий пользователь в системе; 
  пользователь с ролью «Пользователь»;
- Тренировка. Ограничения: существующая тренировка в системе;
- Оценка. Оценка от 1 до 5 (включительно). Ограничения: только целые числа; числа в диапазоне от 1 до 5 (включительно).
- Текст отзыва. Ограничения: обязательно для заполнения; минимум 100 символов; максимум 1024 символа.
- Дата создания отзыва. Ограничения: обязательно для заполнения.

### Заказ (покупка)

Заказ тренировки представлен набором информации:

- **Вид покупки**. Ограничения: обязательно для заполнения; `абонемент`.
- **Услуга**. Тренировка. Ограничения: обязательно для заполнения; существующая в системе тренировка. Указать id.
- **Цена тренировки**. Стоимость приобретаемой тренировки.
- **Количество**. Количество приобретаемых тренировок. Ограничения: целое число; обязательно для заполнения; минимальное значение `1`, максимальное `50`.
- **Сумма заказа**. Стоимость заказа. Рассчитывается по формуле: `количество * цена тренировки`.
- **Способ оплаты**. Вариант оплаты заказа. Ограничения: обязательно для заполнения; один из вариантов: `visa`, `mir`, `umoney`.
- **Дата создания заказа**. Дата и время создания заказа.

### Заявка на индивидуальную тренировку представлена набором информации:

- Инициатор. Инициатор тренировки. Ограничения: обязательно для заполнения; существующий пользователь в системе с ролью «Пользователь».
- Пользователь. Тренер или другой пользователь, с кем проводится тренировка. Ограничения: обязательно для заполнения; существующий пользователь в системе с ролью «Пользователь» или «Тренер»; не может быть выбран пользователь, являющийся инициатором тренировки.
- Дата создания заявки. Дата создания заявки на персональную тренировку. Формируется автоматически.
- Дата изменения статуса. Дата присвоения очередного статуса.
- Статус заявки. Текущий статус заявки. Ограничения: обязательно для заполнения; один из вариантов: на `рассмотрении`, `отклонён`, `принят`.

### Оповещение

Оповещение для пользователя представлено набором информации:

- **Дата оповещения**. Дата создания оповещения. Ограничения: обязательно для заполнения.
- **Пользователь**. Пользователь для которого предназначено оповещение. Ограничения: обязательно для заполнения; существующий пользователь в системе.
- **Текст оповещения**. Произвольный текст оповещения. Ограничения: обязательно для заполнения; минимальная длина `10` символов; максимальная длина `140` символов.

### Баланс пользователя

Хранит информацию о купленных тренировках пользователя.

Набор информации для хранения:
- Тренировка;
- Количество доступных тренировок;

## Начальное наполнение базы

Для начального наполнения базы данных предусмотрена отдельная функциональная возможность. Реализация остаётся на усмотрение разработчика. Генерации 5-10 сущностей каждого вида достаточно.

## Сценарии

### 1. Общие

1.1. Данные, полученные от клиента, всегда проверяются перед использованием (валидируются).

1.2. В случае обнаружения ошибок, клиенту отправляется соответствующий код ответа (400) и список ошибок валидации.

1.3. Изображения, а также файлы, полученные от клиента могут хранится как в файловой системе, так и в базе данных.

1.4. Не допускается хранение пароля пользователя в открытом виде. В базе данных хранится хэш пароля. Для получения хэш-пароля применяется пакет bcrypt.

1.5. Сервис никогда не возвращает конфиденциальных данных. Например, пароли.

1.6. Для описания контрактов применяются DTO/RDO объекты.

1.7. Для передачи данных, необходимых для работы приложения используются переменные окружения. Значения из переменных окружения проходят обязательную валидацию. Некорректные данные или нехватка обязательных данных приводят к остановке приложения и выводу информации об ошибках.

1.8. В коде приложения не должно быть «зашито» конфиденциальных данных (пароли, секреты и так далее).

1.9. Для каждого ресурса предусмотрен файл [service_name].http (хранится в директории со всеми файлами ресурса). В нём приведены заготовки запросов для проверки работоспособности ресурса.

1.10. Специфичные уникальные идентификаторы, которые передаёт клиент (например, идентификатор документа MongoDB) проходят предварительную валидацию. Нужно убедиться, что идентификатор предоставлен корректным значением.

1.11. Ресурсы, возвращающие коллекции (списки), по умолчанию ограничению возвращаемые данные. Ресурс не возвращает больше 50 элементов коллекции. Клиент может уменьшить это количество, передав дополнительный параметр. Увеличить нельзя.

1.12. Ресурсы, возвращающие коллекции (списки) поддерживают параметры и логику, позволяющие организовать постраничную навигацию. Кейс: получить очередные 50 записей.

1.13. Ресурсы, возвращающие коллекции (списки) поддерживают сортировку. По умолчанию используется сортировка по убыванию (дата создания элемента). Клиент может изменить направление сортировки.

1.14. Фильтрация и сортировка происходит на стороне сервера.

### 2. Пользователи

#### Регистрация пользователя
- Регистрация доступна только анонимным клиентам.
- Авторизованный пользователь при попытке пройти регистрацию получает соответствующий код ответа.
- Для регистрации клиент передаёт набор информации, перечисленный в разделе «Предметная область» -> «Пользователь». Объём передаваемой информации зависит от выбранной роли пользователя. Данные для полей, которые рассчитываются автоматически, клиент информацию не передаёт.
- В случае успешной регистрации нового пользователя, сервис возвращает соответствующий код ответа и объект с созданным пользователем.

#### Вход в систему
- Для ограничение доступа пользователей используются JWT (JSON WebTokens).
- Войти в систему могут только анонимные клиенты. Если авторизованный клиент входит в систему, сервер возвращает соответствующий код и текущий токен. Новая пара токенов не создаётся.
- Для процедуры аутентификации и авторизации клиент передаёт электронную почту и пароль.
- В сервисе реализована поддержка Access Token и Refresh Token.
- Время жизни Access Token — `15` минут. Время жизни Refresh Token: `7` дней. Время жизни токенов может быть переназначено через переменные окружения.
- Для формирования Access Token и Refresh Token используются разные секреты. Секреты передаются через переменные окружения.
- Сервис предусматривает сценарий отзыва Refresh Token.
- После прохождения авторизации, клиент передаёт Access Token в заголовке `Authorization`. Используется `Bearer`.

#### Детальная информация о пользователе (Карточка пользователя)
- Клиент может запросить детальную информацию о произвольном пользователя. Для запроса информации клиент в обязательном порядке передаёт уникальный идентификатор пользователя в приложении, по которому требуется получить информацию.
- Информацию о пользователе могут запрашивать только авторизованные клиенты.
- При запросе информации о пользователе сервис возвращает весь набор информации, перечисленный описании сущности `«Пользователь»`, кроме пароля.

#### Редактирование информации о пользователе
- Авторизованный клиент может обновить профиль своего пользователя в приложении.
- Авторизованный клиент может обновлять только профиль своего пользователя. Редактирование информации произвольного пользователя не допускается.
- Клиент может обновить значения любых полей за исключением: электронная почта, роль, пароль.
- Частичное обновление допускается. Например, чтобы обновить имя пользователя, авторизованный клиент может передать только имя, а не полную информацию о пользователе. Обратите внимание, ресурс для редактирования информации о пользователе позволяет редактировать информацию о пользователе с любой ролью.

#### Список (каталог) пользователей
- Сервис предоставляет ресурс для получения списка пользователей. Запросить список пользователей могут только авторизованные пользователи с ролью `«Пользователь»`.
- Каждый пользователь в списке представлен набором информации, определённый с разделе `«Предметная область»` -> `«Пользователь»` кроме конфиденциальной информации.
- В каталоге доступна фильтрация: по локации, специализации и уровню подготовки, а также сортировка по роли пользователя: тренер или обычный пользователь.

### 3. Личный кабинет тренера

#### Создание тренировки
Создавать новые тренировки могут только авторизованные клиенты с ролью «Тренер».
Количество создаваемых тренировок не ограничено.
Для создания новой тренировки клиент передаёт набор информации, перечисленный в описании сущности «Тренировка».
Фоновые изображения используются предопределённые из макета (вёрстки). При сохранении тренировки присваивается случайное изображение.
После создания новой тренировки сервис возвращает объект с информацией о созданной тренировке.

#### Редактирование тренировки
- Редактировать тренировку могут только авторизованные клиенты с ролью «Тренер». Тренер может отредактировать тренировки, созданные им.
- Для редактирования тренировки передаётся набор изменяемой информации, а также уникальный идентификатор тренировки. Допускается частичное редактирование.
- После редактирования тренировки сервис возвращает обновлённую информации по тренировке.

#### Детальная информация о тренировке
- Детальную информацию о тренировке могут запросить только авторизованные клиенты. Для получения детальной информации клиент передаёт уникальный идентификатор тренировки.
- Детальная информация о тренировке содержит всю информацию, представленную в описании сущности «Тренировка».

#### Список тренировок
- Сервис предоставляет ресурс для получения списка тренировок. Список тренировок может запросить авторизованный пользователь с ролью «Тренер». Сервис возвращает список тренировок авторизованного клиента. Клиент не может запросить список тренировок произвольного тренера.
- Каждая тренировка представлена набором информации, приведённом в описании сущности «Тренировка».
- Клиент может запросить список тренировок с применением фильтров. Фильтры опциональны. Фильтры передаются через параметры. Доступные фильтры:
    - Диапазон цены. Значение «от» и «до» (>= и <=);
    - Диапазон калорий. Значение «от» и «до» (>= и <=);
    - Рейтинг. Целое число от 0 до 5;
    - Длительность. Один или несколько предопределённых диапазонов: 10 мин — 30 мин, 30 мин — 50 мин, 50 мин — 80 мин, 80 мин — 100 мин.

#### Мои заказы
- Сервис предоставляет ресурс для получения списка заказов (тренировки, которые купили пользователи). Запросить список заказов могут только авторизованные пользователи с ролью «Тренер».
- Сервис возвращает список заказов только авторизованного клиента. Клиент не может запросить список заказов произвольного тренера.
- Каждый заказ представлен информацией о тренировке (смотри описание сущности `«Тренировка»`), а также содержит статистическую информацию:
    - количество купленных тренировок данного вида;
    - общая сумма за проданные тренировки.
- Общая сумма за проданные тренировки считается путём суммирования поля `«Цена»` у проданных тренировок. Решать задачу, связанную с возможностью изменения цены тренировки — не нужно. Реализовывать историю цен не нужно.
- Клиент может применить сортировку для списка заказов: количество купленных тренировок (возрастание, убывание), заработанная сумма (возрастание, убывание).

#### Список друзей
- Ресурс доступен только авторизованным пользователям. Сервис возвращает список друзей (пользователей) для текущего авторизованного пользователя. Получить список друзей произвольного пользователя нельзя.
- Каждый друг в списке представлен набором информации, перечисленной в разделе «Предметная область» -> «Пользователь».

### 4. Личный кабинет пользователя

#### Список друзей
- Сервис предоставляет ресурсы для формирования списка друзей пользователя;
- Ресурсы доступны только авторизованным клиентам;
- Доступные действия: добавить в друзья, удалить из списка друзей, получить список друзей.
- Пользователи с ролью «Тренер» не могут добавлять пользователя в друзья.

#### Баланс пользователя
- Баланс могут запрашивать только авторизованные пользователи с ролью «Пользователь»
- Сервис предоставляет ресурс для получения общего баланса: количество доступных тренировок.
- Сервис предоставляет ресурс для обновления баланса тренировок (поступление, списание).

#### Уведомления о новых тренировках
- Пользователь может подписаться на получение уведомлений по email на появление новых тренировок определённого тренера;
- При создании новой тренировки уведомление отправляется не сразу. Уведомление добавляется в очередь. Для запуска рассылки уведомлений сервис предоставляет отдельный ресурс.
- Пользователь может отписаться от получения уведомлений о появлении новых тренировок. При этом ранее запланированные уведомления будут доставлены при очередной отправке.
- Для рассылки почтовых уведомлений используется тестовый smtp-сервер. Для разворачивания smtp-сервера используется Docker.
- Текст уведомления о новой тренировке, а также оформление email остаётся на усмотрение студента.

### 5. Оповещения

#### Список оповещений
- Список оповещений могут запросить только авторизованные пользователи. Список оповещений формируется для текущего авторизованного пользователя. Клиент не может запросить список оповещений для произвольного пользователя.
- Каждое оповещение в списке представлено набором информации из «Предметная область» -> «Оповещение».
- Оповещение приходит пользователю в случае: добавление в друзья, приглашения на тренировку, запрос на персональную тренировку.

#### Удалить оповещение
- Ресурс позволяет удалить оповещение. Ресурс доступен только авторизованным пользователям.
- Авторизованный пользователь может удалять только свои оповещения.
- Удаление оповещения происходит при клике на текст оповещения. Показывается только 5 последних оповещений

### Создание оповещения
- Отдельный ресурс для создания оповещений не предусмотрен. Оповещения создаются внутри рабочих сценариев приложения.

### 6. Персональные тренировки/совместные тренировки

#### Создание заявки на персональную/совместную тренировку
- Сервис предоставляет ресурс для создания заявок на персональные и совместные тренировки. Ресурс доступен авторизованным клиентам с ролью «Пользователь».
- Для создания заявки на персональную тренировку клиент передаёт набор информации перечисленную в разделе «Предметная область» -> «Заявка на персональную тренировку». Заявка на тренировку создаётся со статусом «На рассмотрении».
- Хранение данных в БД опционально.

#### Изменение статуса заявки
- Ресурс доступен авторизованным клиентам.
- Для изменения статус заявки на персональную тренировку клиент передаёт идентификатор заявки и новый статус.
- Если новый статус равен предыдущему, обновление не происходит.

### 7. Каталог тренировок
- Сервис предоставляет ресурс для получения списка тренировок.
- Ресурс поддерживает фильтры: по цене, по затрачиваемым калориям, по рейтингу, по типу.
- Ресурс поддерживает сортировку по цене.
- Ресурс доступен только авторизованным пользователям.

### 8. Отзывы

### Создание отзыва к тренировке
- Отзывы к тренировке могут создавать только авторизованные клиенты с ролью `«Пользователь»`.
- Для создания нового отзыва клиент передаёт набор информации, перечисленный в разделе `«Предметная область»` -> `«Отзыв»`.
- В случае успешного создания отзыва, сервис возвращает объект созданного отзыва.
- Редактирование и удаление отзывов не предусмотрено.
- После добавления отзыва выполняется пересчёт рейтинга тренировки. Рейтинг тренировки рассчитывается по среднему.

### Список отзывов к тренировке
- Сервис предоставляет ресурс для получения списка отзывов для определённой тренировки. Запросить список отзывов к тренировкам может только авторизованный пользователь.
- Каждый отзыв представлен набором информации, перечисленный в описании сущности `«Отзыв»`.

## Документация
- В description.md проекта указана вся необходимая информация для запуска проекта. Описано предназначение всех сценариев, которые используются для разработки/запуска проекта.
- API задокументирован в формате OpenAPI. Это может быть отдельный файл specification.yml, расположенный в корневой директории проекта, либо отдельный маршрут по которому будет сформирована спецификация. При использовании второго варианта, маршрут для получения спецификации указывается в файле `description.md`.
